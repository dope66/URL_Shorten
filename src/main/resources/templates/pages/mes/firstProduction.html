<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        select {
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
            box-sizing: border-box;
        }
        #workerImage {
            align-content: end;
            object-fit: contain;
            width: 300px;
            height: 100%;
        }
        #keyboardModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f0f0f0;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;

        }
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }
        .keyboard-button {
            padding: 15px 25px;

            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .keyboard-button:hover {
            background-color: #e0e0e0;
        }
        .keyboard-ok-button{
            padding: 10px 18px;

            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }


    </style>
</head>
<body>
<form id="production-test-form">
    <label for="processName">생산 설비 </label><select name="processName" id="processName">
    <option value="" disabled selected>생산 설비</option>
</select>
    <label for="equipmentName">호기 </label><select name="equipmentName" id="equipmentName">
</select>
<label for="processWorker">공정원 </label><input readonly type="text" name="processWorker" id="processWorker">
<label for="test1"></label>검사 1<input type="text" readonly value="검사 1" id="test1">
<label for="test2"></label>검사 2<input type="text" readonly value="검사 2" id="test2">
    <label for="productionCount">생산수량</label>
    <input type="text" name="productionCount" id="productionCount" onclick="openKeyboardForCount('productionCount')">

    <label for="defectCount">불량수량</label>
    <input type="text" name="defectCount" id="defectCount" onclick="openKeyboardForCount('defectCount')">

    <input type="hidden" id="workerId">
    <div id="image-container">
        <img id="workerImage" alt="workerImage">
    </div>
    <button>등록</button>
</form>
<div id="keyboardModal" class="modal">
    <div class="modal-content">
        <div class="keyboard-row">
            <button class="keyboard-button" onclick="pressKey(1)">1</button>
            <button class="keyboard-button" onclick="pressKey(2)">2</button>
            <button class="keyboard-button" onclick="pressKey(3)">3</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-button" onclick="pressKey(4)">4</button>
            <button class="keyboard-button" onclick="pressKey(5)">5</button>
            <button class="keyboard-button" onclick="pressKey(6)">6</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-button" onclick="pressKey(7)">7</button>
            <button class="keyboard-button" onclick="pressKey(8)">8</button>
            <button class="keyboard-button" onclick="pressKey(9)">9</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-button" onclick="pressKey('Cancel')">&times;</button>
            <button class="keyboard-button" onclick="pressKey(0)">0</button>
            <button class="keyboard-ok-button" onclick="pressKey('OK')">OK</button>
        </div>
    </div>
</div>

</body>

<script>


    function fetchProcessNameAndWorkerName() {
        const selectedProcessName = document.getElementById("processName");
        const equipmentNameSelect = document.getElementById("equipmentName");
        const workerNameSelect = document.getElementById("processWorker");

        // equipmentNameSelect 초기화
        equipmentNameSelect.innerHTML = '<option value="" disabled selected>선택하세요</option>';


        // fetch(`/api/worker/getEquipmentName?processName=${encodeURIComponent(selectedProcessName.value)}`)
        fetch(`/api/worker/getEquipmentName?processName=${selectedProcessName.value}`)
            .then(response => response.json())
            .then(equipmentNames => {
                console.log("equipmentName : ", equipmentNames);
                equipmentNames.forEach(equipmentName => {
                    const option = document.createElement('option');
                    option.text = equipmentName;
                    option.value = equipmentName;
                    equipmentNameSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('fetch 오류 요청 ', error);
            });
    }

    const processNameSelect = document.getElementById("processName");
    const equipmentNameSelect = document.getElementById("equipmentName");
    const processWorkerSelect = document.getElementById("processWorker");
    const worekerIdselect = document.getElementById("workerId");
    processNameSelect.addEventListener('change', () => {
        // productionType 변경 시 productionName 값 초기화
        equipmentNameSelect.value = '';
        fetchProcessNameAndWorkerName();
    });

    // equipmentNameSelect.addEventListener('change', () => {
    //     fetch(`/api/worker/getWorkerName?processName=${processNameSelect.value}&equipmentName=${equipmentNameSelect.value}`)
    //         .then(response => response.json())
    //         .then(workerName => {
    //             console.log("workerName", workerName);
    //             processWorkerSelect.value = workerName;
    //         }).catch(error => {
    //         console.error('fetch 오류 요청 ', error);
    //     });
    // });
    equipmentNameSelect.addEventListener('change', () => {
        fetch(`/api/worker/getWorkerName?processName=${processNameSelect.value}&equipmentName=${equipmentNameSelect.value}`)
            .then(response => response.json())
            .then(workerInfo => {
                console.log("workerInfo", workerInfo);
                console.log("workerInfo.value", workerInfo.value);
                processWorkerSelect.value = workerInfo;
                fetch(`/api/worker/getWorkerId?processName=${processNameSelect.value}&equipmentName=${equipmentNameSelect.value}&workerName=${processWorkerSelect.value}`)
                    .then(response=>response.json())
                    .then(workerId=>{
                        console.log("workerId",workerId);
                        worekerIdselect.value=workerId;
                        var imageUrl="/api/worker/getBase64Image?id=" + workerId;
                        fetch(imageUrl)
                            .then(function (response) {
                                return response.text();
                            })
                            .then(function (data) {
                                var imageElement = document.querySelector("#workerImage"); // 이미지 태그의 ID
                                if (imageElement) {
                                    imageElement.src = data;
                                }
                            })
                            .catch(function (error) {
                                console.error('Error:', error);
                            });
                    }) .catch(error => {
                    console.error('아이디를 가져오는 도중 오류 발생: ', error);
                });

            })
            .catch(error => {
                console.error('fetch 오류 요청 ', error);
            });
    });






    // 페이지 로드 시 processNameSelect 요소 초기화
    fetch('/api/worker/getProcessName')
        .then(response => response.json())
        .then(data => {
            console.log("processname: ", data);
            data.forEach(processName => {
                const option = document.createElement('option');
                option.text = processName;
                option.value = processName;
                processNameSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('fetch 오류 요청 ', error);
        });

    // 페이지 로드 시 fetchProcessNameAndWorkerName 함수 호출하여 초기화
    fetchProcessNameAndWorkerName();
</script>
<script>
    const productionTestForm = document.getElementById("production-test-form");
    productionTestForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const processName = document.getElementById('processName').value;
        const equipmentName = document.getElementById("equipmentName").value;
        const processWorker = document.getElementById('processWorker').value;
        const productionCount = document.getElementById('productionCount').value;
        const defectCount = document.getElementById('defectCount').value;
        const newTest = {processName, equipmentName, processWorker, productionCount, defectCount};
        console.log("new Test ;",newTest);
        const confirmed = window.confirm('정말로 등록하시겠습니까?');
        if (confirmed) {
            // 확인을 선택한 경우에만 등록 진행
            fetch('/api/Test/productionTest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newTest)
            })
                .then(response => {
                    if (response.ok) {
                        alert('등록이 완료되었습니다.');
                        window.close();
                    }
                })
                .catch(error => {
                    console.error('fetch 오류 요청 ', error);
                });
        }
    });


</script>
<script>

    function openKeyboardForCount(inputId) {
        // Set a global variable to keep track of the current input field
        currentInputField = document.getElementById(inputId);

        // Open the keyboard modal only if the clicked input field is for productionCount or defectCount
        if (inputId === 'productionCount' || inputId === 'defectCount') {
            openKeyboard();
        }
    }

    // Global variable to keep track of the current input field
    var currentInputField;
    function pressKey(key) {
        if (key === "OK") {
            // 모달을 닫기만 하고 값을 설정하지 않음
            closeKeyboard();
        } else if (key === "Cancel") {
            // Clear input field and close the keyboard modal
            currentInputField.value = "";
            closeKeyboard();
        } else {
            // Add numeric key value to the input field
            currentInputField.value += key;
        }
    }

    function openKeyboard() {
        var modal = document.getElementById("keyboardModal");
        modal.style.display = "block";
    }

    // JavaScript 코드에 closeKeyboard 함수 추가
    function closeKeyboard() {
        var modal = document.getElementById("keyboardModal");
        modal.style.display = "none";
    }


</script>

</html>